# Schema for AI QA Gate module

ai_qa_gate.qa_profile.*:
  type: config_entity
  label: 'QA Profile'
  mapping:
    id:
      type: string
      label: 'Machine name'
    label:
      type: label
      label: 'Label'
    enabled:
      type: boolean
      label: 'Enabled'
    target_entity_type_id:
      type: string
      label: 'Target entity type ID'
    target_bundle:
      type: string
      label: 'Target bundle'
    fields_to_analyze:
      type: sequence
      label: 'Fields to analyze'
      sequence:
        type: mapping
        label: 'Field configuration'
        mapping:
          field_name:
            type: string
            label: 'Field name'
          weight:
            type: integer
            label: 'Weight'
          include_label:
            type: boolean
            label: 'Include field label'
          include_referenced_labels:
            type: boolean
            label: 'Include referenced entity labels'
          strip_html:
            type: boolean
            label: 'Strip HTML tags'
    include_meta:
      type: mapping
      label: 'Include metadata'
      mapping:
        include_entity_label:
          type: boolean
          label: 'Include entity label'
        include_langcode:
          type: boolean
          label: 'Include language code'
        include_bundle:
          type: boolean
          label: 'Include bundle'
        include_moderation_state:
          type: boolean
          label: 'Include moderation state'
        include_taxonomy_labels:
          type: boolean
          label: 'Include taxonomy labels'
    agents_enabled:
      type: sequence
      label: 'Enabled agents'
      sequence:
        type: string
        label: 'Agent ID'
    execution_settings:
      type: mapping
      label: 'Execution settings'
      mapping:
        run_mode:
          type: string
          label: 'Run mode'
        cache_ttl_seconds:
          type: integer
          label: 'Cache TTL in seconds'
    gating_settings:
      type: mapping
      label: 'Gating settings'
      mapping:
        gating_enabled:
          type: boolean
          label: 'Gating enabled'
        severity_threshold:
          type: string
          label: 'Severity threshold'
        apply_to_states:
          type: sequence
          label: 'Apply to states'
          sequence:
            type: string
            label: 'State ID'
        block_transition_ids:
          type: sequence
          label: 'Block transition IDs'
          sequence:
            type: string
            label: 'Transition ID'
        require_acknowledgement:
          type: boolean
          label: 'Require acknowledgement'
        acknowledgement_field:
          type: string
          label: 'Acknowledgement field'
          nullable: true
    access_settings:
      type: mapping
      label: 'Access settings'
      mapping:
        roles_allowed_to_run:
          type: sequence
          label: 'Roles allowed to run'
          sequence:
            type: string
            label: 'Role ID'

ai_qa_gate.settings:
  type: config_object
  label: 'AI QA Gate settings'
  mapping:
    default_run_mode:
      type: string
      label: 'Default run mode'
    log_ai_requests:
      type: boolean
      label: 'Log AI requests'
    plugin_backoff_seconds:
      type: integer
      label: 'Backoff seconds between plugin runs'
    retry_on_rate_limit:
      type: boolean
      label: 'Retry on rate limit errors'
    max_retries:
      type: integer
      label: 'Maximum retry attempts'
    retry_backoff_multiplier:
      type: float
      label: 'Retry backoff multiplier'

ai_agents.ai_agent.*.third_party.ai_qa_gate:
  type: mapping
  label: 'AI QA Gate settings'
  mapping:
    qa_report_plugin_id:
      type: string
      label: 'QA Report plugin ID'
    qa_report_configuration:
      type: ignore
      label: 'Plugin configuration'
